{"version":3,"file":"jquery.fluidbox.js","sources":["jquery.fluidbox.js"],"sourcesContent":["// the semi-colon before function invocation is a safety net against concatenated\n// scripts and/or other plugins which may not be closed properly.\n;(function ( $, window, document, undefined ) {\n\n\t\"use strict\";\n\n\t\t// undefined is used here as the undefined global variable in ECMAScript 3 is\n\t\t// mutable (ie. it can be changed by someone else). undefined isn't really being\n\t\t// passed in so we can ensure the value of it is truly undefined. In ES5, undefined\n\t\t// can no longer be modified.\n\n\t\t// window and document are passed through as local variable rather than global\n\t\t// as this (slightly) quickens the resolution process and can be more efficiently\n\t\t// minified (especially when both are regularly referenced in your plugin).\n\n\t\t// Create the defaults once\n\t\tvar $w\t\t\t= $(window),\n\t\t\t$d\t\t\t= $(document),\n\t\t\tpluginName\t= \"fluidbox\",\n\t\t\tdefaults\t= {\n\t\t\t\timmediateOpen: false,\n\t\t\t\tloader: false,\n\t\t\t\tmaxWidth: 0,\n\t\t\t\tmaxHeight: 0,\n\t\t\t\tresizeThrottle: 500,\n\t\t\t\tstackIndex: 1000,\n\t\t\t\tstackIndexDelta: 10,\n\t\t\t\tviewportFill: 0.95,\n\t\t\t},\n\t\t\tglobalData = {},\n\t\t\tkeyboardEvents = ['keyup', 'keydown', 'keypress'];\n\n\t\t// Global plugin instance tracker\n\t\tvar fbInstance = 0;\n\n                // Check the availability of the console object. This ensures compatibility with IE8.\n                if(typeof console === \"undefined\" || console.warn === \"undefined\" ) {\n                    console = {};\n                    console.warn = function(){};\n                }\n\n\t\t// Check if dependencies are loaded\n\t\t// 1. Ben Almen's debounce/throttle plugin\n\t\tif (!$.isFunction($.throttle)) {\n\t\t\tconsole.warn('Fluidbox: The jQuery debounce/throttle plugin is not found/loaded. Even though Fluidbox works without it, the window resize event will fire extremely rapidly in browsers, resulting in significant degradation in performance upon viewport resize.');\n\t\t}\n\n\t\t// ---------------------------------------------------------------------------------------------------------------------- //\n\t\t//  Dependency: David Walsh (http://davidwalsh.name/css-animation-callback)                                               //\n\t\t//              and                                                                                                       //\n\t\t//              Jonathan Suh (https://jonsuh.com/blog/detect-the-end-of-css-animations-and-transitions-with-javascript/)  //\n\t\t// ---------------------------------------------------------------------------------------------------------------------- //\n\t\tvar whichTransitionEvent = function() {\n\t\t\tvar t,\n\t\t\t\tel = document.createElement(\"fakeelement\");\n\n\t\t\tvar transitions = {\n\t\t\t\t\"transition\"      : \"transitionend\",\n\t\t\t\t\"OTransition\"     : \"oTransitionEnd\",\n\t\t\t\t\"MozTransition\"   : \"transitionend\",\n\t\t\t\t\"WebkitTransition\": \"webkitTransitionEnd\"\n\t\t\t};\n\n\t\t\tfor (t in transitions){\n\t\t\t\tif (el.style[t] !== undefined){\n\t\t\t\t\treturn transitions[t];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tvar customTransitionEnd = whichTransitionEvent();\n\n\t\t// The actual plugin constructor\n\t\tfunction Plugin (element, options) {\n\t\t\t// Assign element\n\t\t\tthis.element = element;\n\n\t\t\t// Manipulate HTML5 dataset object\n\t\t\t// -  Format: data-fluidbox-(setting-name). When converted into camel case: fluidboxSettingName\n\t\t\t// - So, we will have to remove 'fluidbox' in the front, and change the first letter to lowercase\n\t\t\tvar elementData = {};\n\t\t\t$.each($(this.element).data(), function(k,v) {\n\t\t\t\tvar capitalize = function(s) {\n\t\t\t\t\t\treturn s && s[0].toLowerCase() + s.slice(1);\n\t\t\t\t\t},\n\t\t\t\t\tkey = capitalize(k.replace('fluidbox',''));\n\n\t\t\t\t// Only push non-empty keys (that are part of the Fluidbox HTML5 data- attributes) into new object\n\t\t\t\tif(key !== '' || key !== null) {\n\t\t\t\t\t// Coerce boolean values\n\t\t\t\t\tif (v == 'false') {\n\t\t\t\t\t\tv = false;\n\t\t\t\t\t} else if (v == 'true') {\n\t\t\t\t\t\tv = true;\n\t\t\t\t\t}\n\t\t\t\t\telementData[key] = v;\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\t// Merge defaults into options, into dataset\n\t\t\tthis.settings = $.extend( {}, defaults, options, elementData);\n\n\t\t\t// Coerce settings\n\t\t\tthis.settings.viewportFill = Math.max(Math.min(parseFloat(this.settings.viewportFill), 1), 0);\n\t\t\tif(this.settings.stackIndex < this.settings.stackIndexDelta) {\n\t\t\t\tsettings.stackIndexDelta = settings.stackIndex;\n\t\t\t}\n\n\t\t\t// Store plugin name\n\t\t\tthis._name = pluginName;\n\n\t\t\t// Initialize\n\t\t\tthis.init();\n\t\t}\n\n\t\t// Private functions\n\t\tvar _fun = {\n\t\t\tdom: function() {\n\t\t\t\t// Wrap and add ghost element\n\t\t\t\tvar $fb_innerWrap = $('<div />', {\n\t\t\t\t\t'class': 'fluidbox__wrap',\n\t\t\t\t\tcss: {\n\t\t\t\t\t\tzIndex: this.settings.stackIndex - this.settings.stackIndexDelta\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$(this.element)\n\t\t\t\t.addClass('fluidbox--closed')\n\t\t\t\t.wrapInner($fb_innerWrap)\n\t\t\t\t.find('img')\n\t\t\t\t\t.first()\n\t\t\t\t\t.css({ opacity: 1})\n\t\t\t\t\t.addClass('fluidbox__thumb')\n\t\t\t\t\t.after('<div class=\"fluidbox__ghost\" />');\n\n\t\t\t\t// Append loader\n\t\t\t\tif(this.settings.loader) {\n\t\t\t\t\tvar $fbLoader = $('<div />', {\n\t\t\t\t\t\t'class': 'fluidbox__loader',\n\t\t\t\t\t\tcss: {\n\t\t\t\t\t\t\tzIndex: 2\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t$(this.element).find('.fluidbox__wrap').append($fbLoader);\n\t\t\t\t}\n\t\t\t},\n\t\t\tprepareFb: function() {\n\t\t\t\tvar fb\t= this,\n\t\t\t\t\t$fb\t= $(this.element);\n\n\t\t\t\t// Thumbnail is successfully loaded, fire event\n\t\t\t\t$fb.trigger('thumbloaddone.fluidbox');\n\n\t\t\t\t// Get basic measurements and to resize the ghost element\n\t\t\t\t_fun.measure.fbElements.call(this);\n\n\t\t\t\t// Bind events\n\t\t\t\tfb.bindEvents();\n\n\t\t\t\t// Status: Fluidbox is ready to use\n\t\t\t\t$fb.addClass('fluidbox--ready');\n\n\t\t\t\t// Bind listeners\n\t\t\t\tfb.bindListeners();\n\n\t\t\t\t// Emit custom event\n\t\t\t\t$fb.trigger('ready.fluidbox');\n\t\t\t},\n\t\t\tmeasure: {\n\t\t\t\tviewport: function() {\n\t\t\t\t\tglobalData.viewport = {\n\t\t\t\t\t\tw: $w.width(),\n\t\t\t\t\t\th: $w.height()\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tfbElements: function() {\n\t\t\t\t\tvar fb\t\t\t= this,\n\t\t\t\t\t\t$fb\t\t\t= $(this.element),\n\t\t\t\t\t\t$fbThumb\t= $fb.find('img').first(),\n\t\t\t\t\t\t$fbGhost\t= $fb.find('.fluidbox__ghost'),\n\t\t\t\t\t\t$fbWrap\t\t= $fb.find('.fluidbox__wrap');\n\n\t\t\t\t\t// Store image dimensions in instance data\n\t\t\t\t\tfb.instanceData.thumb = {\n\t\t\t\t\t\tnatW:\t$fbThumb[0].naturalWidth,\n\t\t\t\t\t\tnatH:\t$fbThumb[0].naturalHeight,\n\t\t\t\t\t\tw:\t\t$fbThumb.width(),\n\t\t\t\t\t\th:\t\t$fbThumb.height()\n\t\t\t\t\t};\n\n\t\t\t\t\t// Set ghost dimensions\n\t\t\t\t\t$fbGhost\n\t\t\t\t\t.css({\n\t\t\t\t\t\twidth: $fbThumb.width(),\n\t\t\t\t\t\theight: $fbThumb.height(),\n\t\t\t\t\t\ttop: $fbThumb.offset().top - $fbWrap.offset().top + parseInt($fbThumb.css('borderTopWidth')) + parseInt($fbThumb.css('paddingTop')),\n\t\t\t\t\t\tleft: $fbThumb.offset().left - $fbWrap.offset().left + parseInt($fbThumb.css('borderLeftWidth')) + parseInt($fbThumb.css('paddingLeft'))\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tcheckURL: function(url) {\n\t\t\t\tvar exitCode = 0;\n\n\t\t\t\tif(/[\\s+]/g.test(url)) {\n\t\t\t\t\tconsole.warn('Fluidbox: Fluidbox opening is halted because it has detected characters in your URL string that need to be properly encoded/escaped. Whitespace(s) have to be escaped manually. See RFC3986 documentation.');\n\t\t\t\t\texitCode = 1;\n\t\t\t\t} else if(/[\\\"\\'\\(\\)]/g.test(url)) {\n\t\t\t\t\tconsole.warn('Fluidbox: Fluidbox opening will proceed, but it has detected characters in your URL string that need to be properly encoded/escaped. These will be escaped for you. See RFC3986 documentation.');\n\t\t\t\t\texitCode = 0;\n\t\t\t\t}\n\t\t\t\treturn exitCode;\n\t\t\t},\n\t\t\tformatURL: function(url) {\n\t\t\t\treturn url\n\t\t\t\t\t.replace(/\"/g, '%22')\n\t\t\t\t\t.replace(/'/g, '%27')\n\t\t\t\t\t.replace(/\\(/g, '%28')\n\t\t\t\t\t.replace(/\\)/g, '%29');\n\t\t\t}\n\t\t};\n\n\t\t// Public functions\n\t\t$.extend(Plugin.prototype, {\n\t\t\tinit: function () {\n\t\t\t\n\t\t\t\t// Define elements\n\t\t\t\tvar fb\t\t\t\t= this,\n\t\t\t\t\t$fb\t\t\t\t= $(this.element),\n\t\t\t\t\t$fbThumb\t\t= $fb.find('img').first();\n\n\t\t\t\t// Get basic measurements\n\t\t\t\t_fun.measure.viewport();\n\n\t\t\t\t// Only perform initialization when\n\t\t\t\t// - It is not yet initialized\n\t\t\t\t// + DOM checks are satisfied:\n\t\t\t\t// +-- An anchor element is selected\n\t\t\t\t// +-- Contains one and only one child\n\t\t\t\t// +-- The only child is an image element OR a picture element\n\t\t\t\t// +-- The element must not be hidden (itself or its parents)\n\t\t\t\tif(\n\t\t\t\t\t(!fb.instanceData || !fb.instanceData.initialized) &&\n\t\t\t\t\t(\n\t\t\t\t\t\t$fb.is('a') &&\n\t\t\t\t\t\t$fb.children().length === 1 &&\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t$fb.children().is('img') || (\n\t\t\t\t\t\t\t\t$fb.children().is('picture') &&\n\t\t\t\t\t\t\t\t$fb.find('img').length === 1\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) &&\n\t\t\t\t\t\t$fb.css('display') !== 'none' &&\n\t\t\t\t\t\t$fb.children().css('display') !== 'none' &&\n\t\t\t\t\t\t$fb.parents().css('display') !== 'none'\n\t\t\t\t\t)\n\t\t\t\t) {\n\n\t\t\t\t\t// Initialize and store original node\n\t\t\t\t\t$fb.removeClass('fluidbox--destroyed');\n\t\t\t\t\tfb.instanceData = {};\n\t\t\t\t\tfb.instanceData.initialized = true;\n\t\t\t\t\tfb.instanceData.originalNode = $fb.html();\n\n\t\t\t\t\t// Append instance ID\n\t\t\t\t\tfbInstance += 1;\n\t\t\t\t\tfb.instanceData.id = fbInstance;\n\t\t\t\t\t$fb.addClass('fluidbox__instance-'+fbInstance);\n\n\t\t\t\t\t// Status: Fluidbox has been initialized\n\t\t\t\t\t$fb.addClass('fluidbox--initialized');\n\n\t\t\t\t\t// DOM replacement\n\t\t\t\t\t_fun.dom.call(fb);\n\n\t\t\t\t\t// Emit custom event\n\t\t\t\t\t$fb.trigger('init.fluidbox');\n\n\t\t\t\t\t// Wait for image to load, but only if image is not found in cache\n\t\t\t\t\tvar img = new Image();\n\t\t\t\t\tif($fbThumb.width() > 0 && $fbThumb.height() > 0) {\n\t\t\t\t\t\t// Thumbnail loaded from cache, let's prepare fluidbox\n\t\t\t\t\t\t_fun.prepareFb.call(fb);\n\t\t\t\t\t} else {\n\t\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\t\t// Thumbnail loaded, let's prepare fluidbox\n\t\t\t\t\t\t\t_fun.prepareFb.call(fb);\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.onerror = function() {\n\t\t\t\t\t\t\t// Trigger custom error event\n\t\t\t\t\t\t\t$fb.trigger('thumbloadfail.fluidbox');\n\t\t\t\t\t\t};\n\t\t\t\t\t\timg.src = $fbThumb.attr('src');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\t\t\topen: function() {\n\t\t\t\t\n\t\t\t\t// Open Fluidbox\n\t\t\t\tvar fb\t\t\t= this,\n\t\t\t\t\t$fb\t\t\t= $(this.element),\n\t\t\t\t\t$fbThumb\t= $fb.find('img').first(),\n\t\t\t\t\t$fbGhost\t= $fb.find('.fluidbox__ghost'),\n\t\t\t\t\t$fbWrap\t\t= $fb.find('.fluidbox__wrap');\n\n\t\t\t\t// Update state\n\t\t\t\tfb.instanceData.state = 1;\n\n\t\t\t\t// Forcibly turn off transition end detection,\n\t\t\t\t// otherwise users will get choppy transition if toggling between states rapidly\n\t\t\t\t$fbGhost.off(customTransitionEnd);\n\n\t\t\t\t// Close all other Fluidbox instances\n\t\t\t\t$('.fluidbox--opened').fluidbox('close');\n\n\t\t\t\t// Append overlay\n\t\t\t\tvar $fbOverlay = $('<div />', {\n\t\t\t\t\t'class': 'fluidbox__overlay',\n\t\t\t\t\tcss: {\n\t\t\t\t\t\tzIndex: -1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$fbWrap.append($fbOverlay);\n\n\t\t\t\t// Add class to indicate larger image being loaded\n\t\t\t\t$fb\n\t\t\t\t.removeClass('fluidbox--closed')\n\t\t\t\t.addClass('fluidbox--loading');\n\n\t\t\t\t// Check of URL is properly formatted\n\t\t\t\tif(_fun.checkURL($fbThumb.attr('src'))) {\n\t\t\t\t\tfb.close();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Set thumbnail image source as background image first, worry later\n\t\t\t\t$fbGhost.css({\n\t\t\t\t\t'background-image': 'url(' + _fun.formatURL($fbThumb.attr('src')) + ')',\n\t\t\t\t\topacity: 1\n\t\t\t\t});\n\n\t\t\t\t// Set dimensions for ghost\n\t\t\t\t_fun.measure.fbElements.call(fb);\n\n\t\t\t\t// Wait for ghost image to preload\n\t\t\t\tvar img;\n\t\t\t\tif (fb.settings.immediateOpen) {\n\t\t\t\t\t// Update classes\n\t\t\t\t\t$fb\n\t\t\t\t\t.addClass('fluidbox--opened fluidbox--loaded')\n\t\t\t\t\t.find('.fluidbox__wrap')\n\t\t\t\t\t\t.css({ zIndex: fb.settings.stackIndex + fb.settings.stackIndexDelta });\n\n\t\t\t\t\t// Emit custom event\n\t\t\t\t\t$fb.trigger('openstart.fluidbox');\n\n\t\t\t\t\t// Compute\n\t\t\t\t\tfb.compute();\n\n\t\t\t\t\t// Hide thumbnail\n\t\t\t\t\t$fbThumb.css({ opacity: 0 });\n\n\t\t\t\t\t// Show overlay\n\t\t\t\t\t$('.fluidbox__overlay').css({ opacity: 1 });\n\n\t\t\t\t\t// Emit custom event when ghost image finishes transition\n\t\t\t\t\t$fbGhost.one(customTransitionEnd, function() {\n\t\t\t\t\t\t$fb.trigger('openend.fluidbox');\n\t\t\t\t\t});\n\n\t\t\t\t\timg = new Image();\n\t\t\t\t\timg.onload = function() {\n\t\t\t\t\t\t// Emit custom event\n\t\t\t\t\t\t$fb.trigger('imageloaddone.fluidbox');\n\n\t\t\t\t\t\t// Perform only if the Fluidbox instance is still open\n\t\t\t\t\t\tif (fb.instanceData.state === 1) {\n\t\t\t\t\t\t\t// Set new natural dimensions\n\t\t\t\t\t\t\tfb.instanceData.thumb.natW = img.naturalWidth;\n\t\t\t\t\t\t\tfb.instanceData.thumb.natH = img.naturalHeight;\n\n\t\t\t\t\t\t\t// Remove loading status\n\t\t\t\t\t\t\t$fb.removeClass('fluidbox--loading');\n\n\t\t\t\t\t\t\t// Check of URL is properly formatted\n\t\t\t\t\t\t\tif(_fun.checkURL(img.src)) {\n\t\t\t\t\t\t\t\tfb.close({ error: true });\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Set new image background\n\t\t\t\t\t\t\t$fbGhost.css({ 'background-image': 'url(' + _fun.formatURL(img.src) + ')' });\n\n\t\t\t\t\t\t\t// Compute\n\t\t\t\t\t\t\tfb.compute();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\timg.onerror = function() {\n\t\t\t\t\t\t// Trigger closing\n\t\t\t\t\t\tfb.close({ error: true });\n\n\t\t\t\t\t\t// Emit custom event\n\t\t\t\t\t\t$fb.trigger('imageloadfail.fluidbox');\n\t\t\t\t\t\t$fb.trigger('delayedloadfail.fluidbox');\n\t\t\t\t\t};\n\t\t\t\t\timg.src = $fb.attr('href');\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\timg = new Image();\n\t\t\t\t\timg.onload = function() {\n\n\t\t\t\t\t\t// Emit custom event\n\t\t\t\t\t\t$fb.trigger('imageloaddone.fluidbox');\n\n\t\t\t\t\t\t// Update classes\n\t\t\t\t\t\t$fb\n\t\t\t\t\t\t.removeClass('fluidbox--loading')\n\t\t\t\t\t\t.addClass('fluidbox--opened fluidbox--loaded')\n\t\t\t\t\t\t.find('.fluidbox__wrap')\n\t\t\t\t\t\t\t.css({ zIndex: fb.settings.stackIndex + fb.settings.stackIndexDelta });\n\n\t\t\t\t\t\t// Emit custom event\n\t\t\t\t\t\t$fb.trigger('openstart.fluidbox');\n\n\t\t\t\t\t\t// Check of URL is properly formatted\n\t\t\t\t\t\tif(_fun.checkURL(img.src)) {\n\t\t\t\t\t\t\tfb.close({ error: true });\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Set new image background\n\t\t\t\t\t\t$fbGhost.css({ 'background-image': 'url(' + _fun.formatURL(img.src) + ')' });\n\n\t\t\t\t\t\t// Set new natural dimensions\n\t\t\t\t\t\tfb.instanceData.thumb.natW = img.naturalWidth;\n\t\t\t\t\t\tfb.instanceData.thumb.natH = img.naturalHeight;\n\n\t\t\t\t\t\t// Compute\n\t\t\t\t\t\tfb.compute();\n\n\t\t\t\t\t\t// Hide thumbnail\n\t\t\t\t\t\t$fbThumb.css({ opacity: 0 });\n\n\t\t\t\t\t\t// Show overlay\n\t\t\t\t\t\t$('.fluidbox__overlay').css({ opacity: 1 });\n\n\t\t\t\t\t\t// Emit custom event when ghost image finishes transition\n\t\t\t\t\t\t$fbGhost.one(customTransitionEnd, function() {\n\t\t\t\t\t\t\t$fb.trigger('openend.fluidbox');\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\timg.onerror = function() {\n\t\t\t\t\t\t// Trigger closing\n\t\t\t\t\t\tfb.close({ error: true });\n\n\t\t\t\t\t\t// Emit custom event\n\t\t\t\t\t\t$fb.trigger('imageloadfail.fluidbox');\n\t\t\t\t\t};\n\t\t\t\t\timg.src = $fb.attr('href');\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t},\n\t\t\tcompute: function() {\n\t\t\t\tvar fb\t\t\t= this,\n\t\t\t\t\t$fb\t\t\t= $(this.element),\n\t\t\t\t\t$fbThumb\t= $fb.find('img').first(),\n\t\t\t\t\t$fbGhost\t= $fb.find('.fluidbox__ghost'),\n\t\t\t\t\t$fbWrap\t\t= $fb.find('.fluidbox__wrap');\n\n\t\t\t\t// Shorthand for dimensions\n\t\t\t\tvar imgNatW = fb.instanceData.thumb.natW,\n\t\t\t\t\timgNatH = fb.instanceData.thumb.natH,\n\t\t\t\t\timgW\t= fb.instanceData.thumb.w,\n\t\t\t\t\timgH\t= fb.instanceData.thumb.h;\n\n\t\t\t\t// Calculate aspect ratios\n\t\t\t\tvar thumbRatio = imgNatW / imgNatH,\n\t\t\t\t\tviewportRatio = globalData.viewport.w / globalData.viewport.h;\n\n\t\t\t\t// Replace dimensions if maxWidth or maxHeight is declared\n\t\t\t\tif (fb.settings.maxWidth > 0) {\n\t\t\t\t\timgNatW = fb.settings.maxWidth;\n\t\t\t\t\timgNatH = imgNatW / thumbRatio;\n\t\t\t\t} else if (fb.settings.maxHeight > 0) {\n\t\t\t\t\timgNatH = fb.settings.maxHeight;\n\t\t\t\t\timgNatW = imgNatH * thumbRatio;\n\t\t\t\t}\n\n\t\t\t\t// Compare image ratio with viewport ratio\n\t\t\t\tvar computedHeight, computedWidth, imgScaleY, imgScaleX, imgMinScale;\n\t\t\t\tif (viewportRatio > thumbRatio) {\n\t\t\t\t\tcomputedHeight\t= (imgNatH < globalData.viewport.h) ? imgNatH : globalData.viewport.h*fb.settings.viewportFill;\n\t\t\t\t\timgScaleY\t\t= computedHeight / imgH;\n\t\t\t\t\timgScaleX\t\t= imgNatW * (imgH * imgScaleY / imgNatH) / imgW;\n\t\t\t\t\timgMinScale\t\t= imgScaleY;\n\t\t\t\t} else {\n\t\t\t\t\tcomputedWidth\t= (imgNatW < globalData.viewport.w) ? imgNatW : globalData.viewport.w*fb.settings.viewportFill;\n\t\t\t\t\timgScaleX\t\t= computedWidth / imgW;\n\t\t\t\t\timgScaleY\t\t= imgNatH * (imgW * imgScaleX / imgNatW) / imgH;\n\t\t\t\t\timgMinScale\t\t= imgScaleX;\n\t\t\t\t}\n\n\t\t\t\t// Display console error if both maxHeight and maxWidth are specific\n\t\t\t\tif (fb.settings.maxWidth && fb.settings.maxHeight)\n\t\t\t\t\tconsole.warn('Fluidbox: Both maxHeight and maxWidth are specified. You can only specify one. If both are specified, only the maxWidth property will be respected. This will not generate any error, but may cause unexpected sizing behavior.');\n\n\t\t\t\t// Scale\n\t\t\t\tvar offsetY = $w.scrollTop() - $fbThumb.offset().top + 0.5*(imgH*(imgMinScale-1)) + 0.5*($w.height() - imgH*imgMinScale),\n\t\t\t\t\toffsetX = 0.5*(imgW*(imgMinScale-1)) + 0.5*($w.width() - imgW*imgMinScale) - $fbThumb.offset().left,\n\t\t\t\t\tscale = parseInt(imgScaleX*100)/100 + ',' + parseInt(imgScaleY*100)/100;\n\n\t\t\t\t// Apply styles to ghost and loader (if present)\n\t\t\t\t$fbGhost\n\t\t\t\t.css({\n\t\t\t\t\t'transform': 'translate(' + parseInt(offsetX*100)/100 + 'px,' + parseInt(offsetY*100)/100 + 'px) scale(' + scale + ')',\n\t\t\t\t\ttop: $fbThumb.offset().top - $fbWrap.offset().top,\n\t\t\t\t\tleft: $fbThumb.offset().left - $fbWrap.offset().left\n\t\t\t\t});\n\t\t\t\t$fb.find('.fluidbox__loader').css({\n\t\t\t\t\t'transform': 'translate(' + parseInt(offsetX*100)/100 + 'px,' + parseInt(offsetY*100)/100 + 'px) scale(' + scale + ')'\n\t\t\t\t});\n\n\t\t\t\t// Emit custom event\n\t\t\t\t$fb.trigger('computeend.fluidbox');\n\t\t\t},\n\t\t\trecompute: function() {\n\t\t\t\t// Recompute is simply an alias for the compute method\n\t\t\t\tthis.compute();\n\t\t\t},\n\t\t\tclose: function(d) {\n\n\t\t\t\t// Close Fluidbox\n\t\t\t\tvar fb\t\t\t= this,\n\t\t\t\t\t$fb\t\t\t= $(this.element),\n\t\t\t\t\t$fbThumb\t= $fb.find('img').first(),\n\t\t\t\t\t$fbGhost\t= $fb.find('.fluidbox__ghost'),\n\t\t\t\t\t$fbWrap\t\t= $fb.find('.fluidbox__wrap'),\n\t\t\t\t\t$fbOverlay\t= $fb.find('.fluidbox__overlay'),\n\t\t\t\t\tcloseData\t= $.extend(null, {\n\t\t\t\t\t\t\t\t\t\terror: false\n\t\t\t\t\t\t\t\t\t}, d);\n\n\t\t\t\t// Do not do anything if Fluidbox is not opened/closed, for performance reasons\n\t\t\t\tif (fb.instanceData.state === null || typeof fb.instanceData.state === typeof undefined || fb.instanceData.state === 0) return false;\n\n\t\t\t\t// Update state\n\t\t\t\tfb.instanceData.state = 0;\n\n\t\t\t\t// Emit custom event\n\t\t\t\t$fb.trigger('closestart.fluidbox');\n\n\t\t\t\t// Change classes\n\t\t\t\t$fb\n\t\t\t\t.removeClass(function(i,c) {\n\t\t\t\t\treturn (c.match (/(^|\\s)fluidbox--(opened|loaded|loading)+/g) || []).join(' ');\n\t\t\t\t})\n\t\t\t\t.addClass('fluidbox--closed');\n\n\t\t\t\t$fbGhost\n\t\t\t\t.css({\n\t\t\t\t\t'transform': 'translate(0,0) scale(1,1)',\n\t\t\t\t\ttop: $fbThumb.offset().top - $fbWrap.offset().top + parseInt($fbThumb.css('borderTopWidth')) + parseInt($fbThumb.css('paddingTop')),\n\t\t\t\t\tleft: $fbThumb.offset().left - $fbWrap.offset().left + parseInt($fbThumb.css('borderLeftWidth')) + parseInt($fbThumb.css('paddingLeft'))\n\t\t\t\t});\n\n\t\t\t\t$fb.find('.fluidbox__loader')\n\t\t\t\t.css({\n\t\t\t\t\t'transform': 'none'\n\t\t\t\t});\n\n\t\t\t\t$fbGhost.one(customTransitionEnd, function() {\n\t\t\t\t\t$fbGhost.css({ opacity: 0 });\n\t\t\t\t\t$fbThumb.css({ opacity: 1 });\n\t\t\t\t\t$fbOverlay.remove();\n\t\t\t\t\t$fbWrap.css({ zIndex: fb.settings.stackIndex - fb.settings.stackIndexDelta });\n\t\t\t\t\t$fb.trigger('closeend.fluidbox');\n\t\t\t\t});\n\n\t\t\t\t// Manually trigger transitionend if an error is detected\n\t\t\t\t// Errors will not trigger any transition changes to the ghost element\n\t\t\t\tif(closeData.error) $fbGhost.trigger('transitionend');\n\n\t\t\t\t// Fadeout overlay\n\t\t\t\t$fbOverlay.css({ opacity: 0 });\t\t\n\t\t\t},\n\t\t\tbindEvents: function() {\n\t\t\t\tvar fb = this,\n\t\t\t\t\t$fb = $(this.element);\n\n\t\t\t\t// Click handler\n\t\t\t\t$fb.on('click.fluidbox', function(e) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Check state\n\t\t\t\t\t// If state does not exist, or if Fluidbox is closed, we open it\n\t\t\t\t\tif(!fb.instanceData.state || fb.instanceData.state === 0) {\n\n\t\t\t\t\t\t// Open Fluidbox\n\t\t\t\t\t\tfb.open();\n\n\t\t\t\t\t// If state exists, we close it\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Close Fluidbox\n\t\t\t\t\t\tfb.close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\tbindListeners: function() {\n\t\t\t\tvar fb\t= this,\n\t\t\t\t\t$fb = $(this.element);\n\n\t\t\t\t// Window resize\n\t\t\t\t// Namespaced using unique instance IDs so that we can unbind resize event specific to a Fluidbox instance\n\t\t\t\tvar resizeFunction = function() {\n\t\t\t\t\t// Re-measure viewport dimensions\n\t\t\t\t\t_fun.measure.viewport();\n\t\t\t\t\t_fun.measure.fbElements.call(fb);\n\n\t\t\t\t\t// Re-compute, but only for the active element\n\t\t\t\t\tif($fb.hasClass('fluidbox--opened')) fb.compute();\n\t\t\t\t};\n\t\t\t\tif ($.isFunction($.throttle)) {\n\t\t\t\t\t$w.on('resize.fluidbox'+fb.instanceData.id, $.throttle(fb.settings.resizeThrottle, resizeFunction));\n\t\t\t\t} else {\n\t\t\t\t\t$w.on('resize.fluidbox'+fb.instanceData.id, resizeFunction);\n\t\t\t\t}\n\n\t\t\t\t// Reposition\n\t\t\t\t$fb.on('reposition.fluidbox', function() {\n\t\t\t\t\tfb.reposition();\n\t\t\t\t});\n\n\t\t\t\t// Recompute\n\t\t\t\t$fb.on('recompute.fluidbox, compute.fluidbox', function() {\n\t\t\t\t\tfb.compute();\n\t\t\t\t});\n\n\t\t\t\t// Destroy\n\t\t\t\t$fb.on('destroy.fluidbox', function() {\n\t\t\t\t\tfb.destroy();\n\t\t\t\t});\n\n\t\t\t\t// Close\n\t\t\t\t$fb.on('close.fluidbox', function() {\n\t\t\t\t\tfb.close();\n\t\t\t\t});\n\t\t\t},\n\t\t\tunbind: function() {\n\t\t\t\t$(this.element).off('click.fluidbox reposition.fluidbox recompute.fluidbox compute.fluidbox destroy.fluidbox close.fluidbox');\n\t\t\t\t$w.off('resize.fluidbox'+this.instanceData.id);\n\t\t\t},\n\t\t\treposition: function() {\n\t\t\t\t_fun.measure.fbElements.call(this);\n\t\t\t},\n\t\t\tdestroy: function() {\n\t\t\t\t// Cache original node\n\t\t\t\tvar originalNode = this.instanceData.originalNode;\n\n\t\t\t\t// Unbind event hanlders\n\t\t\t\tthis.unbind();\n\n\t\t\t\t// Destroy plugin data entirely\n\t\t\t\t$.data(this.element, 'plugin_' + pluginName, null);\n\n\t\t\t\t// DOM reversal\n\t\t\t\t$(this.element)\n\t\t\t\t.removeClass(function(i,c) {\n\t\t\t\t\treturn (c.match (/(^|\\s)fluidbox[--|__]\\S+/g) || []).join(' ');\n\t\t\t\t})\n\t\t\t\t.empty()\n\t\t\t\t.html(originalNode)\n\t\t\t\t.addClass('fluidbox--destroyed')\n\t\t\t\t.trigger('destroyed.fluidbox');\n\t\t\t},\n\t\t\tgetMetadata: function() {\n\t\t\t\t// Return instance data\n\t\t\t\treturn this.instanceData;\n\t\t\t}\n\t\t});\n\n\t\t// A really lightweight plugin wrapper around the constructor,\n\t\t// preventing against multiple instantiations\n\t\t$.fn[pluginName] = function (options) {\n\n\t\t\tvar args = arguments;\n\n\t\t\t// Check the options parameter\n\t\t\t// If it is undefined or is an object (plugin configuration),\n\t\t\t// we create a new instance (conditionally, see inside) of the plugin\n\t\t\tif (options === undefined || typeof options === 'object') {\n\n\t\t\t\treturn this.each(function() {\n\t\t\t\t\t// Only if the plugin_fluidbox data is not present,\n\t\t\t\t\t// to prevent multiple instances being created\n\t\t\t\t\tif (!$.data(this, \"plugin_\" + pluginName)) {\n\n\t\t\t\t\t\t$.data(this, \"plugin_\" + pluginName, new Plugin(this, options));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t// If it is defined, but it is a string, does not start with an underscore and does not call init(),\n\t\t\t// we allow users to make calls to public methods\n\t\t\t} else if (typeof options === 'string' && options[0] !== '_' && options !== 'init') {\n\t\t\t\tvar returnVal;\n\n\t\t\t\tthis.each(function() {\n\t\t\t\t\tvar instance = $.data(this, 'plugin_' + pluginName);\n\t\t\t\t\tif (instance instanceof Plugin && typeof instance[options] === 'function') {\n\t\t\t\t\t\treturnVal = instance[options].apply(instance, Array.prototype.slice.call(args, 1));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn('Fluidbox: The method \"' + options + '\" used is not defined in Fluidbox. Please make sure you are calling the correct public method.');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn returnVal !== undefined ? returnVal : this;\n\t\t\t}\n\n\t\t\t// Return to allow chaining\n\t\t\treturn this;\n\t\t};\n\n\n\n})(jQuery, window, document);\n"],"names":["$","window","document","undefined","$w","pluginName","defaults","immediateOpen","loader","maxWidth","maxHeight","resizeThrottle","stackIndex","stackIndexDelta","viewportFill","globalData","fbInstance","console","warn","isFunction","throttle","customTransitionEnd","t","el","createElement","transitions","transition","OTransition","MozTransition","WebkitTransition","style","whichTransitionEvent","Plugin","element","options","this","elementData","each","data","k","v","s","key","replace","toLowerCase","slice","settings","extend","Math","max","min","parseFloat","_name","init","_fun","dom","$fbLoader","$fb_innerWrap","class","css","zIndex","addClass","wrapInner","find","first","opacity","after","append","prepareFb","$fb","trigger","measure","fbElements","call","bindEvents","bindListeners","viewport","w","width","h","height","$fbThumb","$fbGhost","$fbWrap","instanceData","thumb","natW","naturalWidth","natH","naturalHeight","top","offset","parseInt","left","checkURL","url","exitCode","test","formatURL","prototype","img","fb","initialized","is","children","length","parents","removeClass","originalNode","html","id","Image","onload","onerror","src","attr","open","state","off","fluidbox","$fbOverlay","close","background-image","compute","one","error","imgScaleY","imgScaleX","imgMinScale","imgNatW","imgNatH","imgW","imgH","thumbRatio","viewportRatio","offsetY","scrollTop","offsetX","scale","transform","recompute","d","closeData","i","c","match","join","remove","on","e","preventDefault","resizeFunction","hasClass","reposition","destroy","unbind","empty","getMetadata","fn","returnVal","args","arguments","instance","apply","Array","jQuery"],"mappings":"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"}